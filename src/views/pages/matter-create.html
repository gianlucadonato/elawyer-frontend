<div class="container matter matter-create">
  <div class="block-header">
    <h2>New Matter</h2>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header ch-alt m-b-20">

          <form>
            <div class="form-group">
              <input type="text" name="Title" class="form-control" placeholder="Title" ng-model="matter.title">
            </div>
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Description" ng-model="matter.description">
            </div>
            <div class="form-group">
              <select class="form-control" ng-model="matter.area_of_interest" ng-value="matter.area_of_interest || 'default'" ng-show="!manual">
                <option value="default" disabled selected>Select Area</option>
                <option ng-repeat="i in areas" value="{{i}}">{{i}}</option>
                <option value="____manual____">Immetti manualmente</option>
              </select>
              <input ng-show="manual" type="text" class="form-control" placeholder="area of interest" ng-model="matter.area_of_interest">
            </div>
          </form>

          <ul class="actions">
            <li tooltip-placement="bottom" uib-tooltip="Save as Template">
              <a href="" ng-click="saveAsTemplate(matter)"><i class="fa fa-floppy-o"></i></a>
            </li>
            <li tooltip-placement="bottom" uib-tooltip="Import from Template">
              <a href="" ng-click="importTemplate()"><i class="zmdi zmdi-download"></i></a>
            </li>
            <li class="dropdown" uib-dropdown>
              <a href="" uib-dropdown-toggle>
                <i class="zmdi zmdi-more-vert"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li>
                  <a href="">Refresh</a>
                </li>
                <li>
                  <a href="">Other</a>
                </li>
              </ul>
            </li>
          </ul>
          <button class="btn bgm-darkorange btn-float waves-effect" ng-click="importService()"
            tooltip-placement="bottom" uib-tooltip="Import Service">
            <i class="zmdi zmdi-plus"></i>
          </button>
          <button class="btn bgm-blue btn-float waves-effect" ng-click="sendMatterModal()"
            tooltip-placement="bottom" uib-tooltip="Send to Client">
            <i class="zmdi zmdi-mail-send"></i>
          </button>
        </div>



        <div class="card-body card-padding">
          <div ui-tree>
            <table ui-tree-nodes="" ng-model="matter.items" class="table table-bordered services">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Services</th>
                  <th>Price</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- SERVICES -->
                <tr ng-repeat="item in matter.items" ui-tree-node>
                  <td ui-tree-handle width="3%">{{$index + 1}}</td>
                  <td width="75%">
                    <form>
                      <div class="form-group">
                        <input type="text" name="Title" class="form-control" placeholder="Title" ng-model="item.title">
                      </div>
                      <div class="form-group">
                        <textarea rows="2" class="form-control" placeholder="Description" ng-model="item.description"></textarea>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox" value="" ng-model="item.is_mandatory">
                          <i class="input-helper"></i>
                        </label>
                        <span>Servizio Obbligatorio</span>
                      </div>
                    </form>
                    <!-- SUB-SERVICES -->
                    <table ui-tree-nodes="" ng-model="item.items" class="table table-bordered sub-services" width="100%">
                      <tbody>
                        <tr ng-repeat="subItem in item.items" ui-tree-node>
                          <td ui-tree-handle width="5%">{{ $parent.$parent.$index + 1 }}.{{$index + 1}}</td>
                          <td width="95%" class="sub-service-item">
                            <form>
                              <div class="form-group">
                                <input type="text" name="Title" class="form-control" placeholder="Title" ng-model="subItem.title">
                              </div>
                              <div class="form-group">
                                <textarea rows="2" class="form-control" placeholder="Description" ng-model="subItem.description"></textarea>
                              </div>
                            </form>
                            <div class="btn-remove">
                              <a href="" ng-click="editor.removeItem(item.items, $index)"><i class="zmdi zmdi-close"></i></a>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                  <td width="8%">
                    <form>
                      <div class="input-group amount">
                        <span class="input-group-addon"><i class="fa fa-eur"></i></span>
                        <input type="text" class="form-control" placeholder="0" ng-model="item.price">
                      </div>
                    </form>
                  </td>
                  <td width="14%" class="text-right">
                    <ul class="actions">
                      <li>
                        <a href="" ng-click="editor.addItem(item.items)"
                          tooltip-placement="bottom" uib-tooltip="Add Sub-Service">
                          <i class="zmdi zmdi-plus"></i>
                        </a>
                      </li>
                      <li>
                        <a href="" ng-click="saveService(item)"
                          tooltip-placement="bottom" uib-tooltip="Save Service">
                          <i class="zmdi" ng-class="{'zmdi-star starred': item.is_starred, 'zmdi-star-outline': !item.is_starred}"></i>
                        </a>
                      </li>
                      <li>
                        <a href="" ng-click="editor.removeItem(matter.items, $index)"
                          tooltip-placement="bottom" uib-tooltip="Remove Service">
                         <i class="zmdi zmdi-delete"></i>
                        </a>
                      </li>
                    </ul>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="card-footer card-padding card-actions">
          <div tooltip-placement="bottom" uib-tooltip="Save in Draft" class="save-as-draft">
            <span ng-if="isSaving && !errorSaving">Saving...</span>
            <span ng-if="errorSaving">Error in saving this matter. Please insert a title</span>
            <span ng-if="!isSaving && !isntSaved">Saved</span>
            <span ng-if="isntSaved && !errorSaving && !isSaving">Not saved.</span>
            <a href="" ng-class="{'is-saving': isSaving}"><i class="zmdi zmdi-check-all"></i></a>
          </div>
          <button class="btn btn-large btn-orange waves-effect" ng-click="editor.addItem(matter.items)">Add Service</button>
        </div>

      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div id="summary-box" class="card m-t-25">
        <div class="card-header ch-alt">
          <h2>Impostazioni di pagamento</h2>
        </div>
        <div class="card-body card-padding">

          <div class="checkbox">
            <label>
              <input type="checkbox" ng-value="matter.withholding_tax" ng-model="matter.withholding_tax">
              <i class="input-helper"></i>
            </label>
            <span>Ritenuta d'acconto</span>
          </div>
        
          <p class="f-500 c-black m-b-5">Percentuale acconto</p>
          <input type="number" name="Title" class="form-control" placeholder="20" max="100" min="0" ng-model="matter.deposit" ng-value="matter.deposit">
          
        </div>

      </div>
    </div>
  </div>


  <div class="row">
    <div class="col-sm-12">
      <div id="summary-box" class="card m-t-25">
        <div class="card-header ch-alt">
          <h2>Summary</h2>
        </div>
        <div class="card-body card-padding">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Servizio</th>
                  <th>Importo</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="i in matter.items" class="outputService">
                  <td>{{i.title}}</td>
                  <td>€ {{i.price | prettyNumber}}</td>
                </tr>
                <tr>
                  <th>&nbsp;</th>
                  <th>&nbsp;</th>
                </tr>
                <tr>
                  <td>Imponibile Prestazioni</td>
                  <td>€ {{total | prettyNumber}}</td>
                </tr>
                <tr>
                  <td>Rimborso spese generali (15%)</td>
                  <td>€ {{(total | percentage: 15) | prettyNumber}}</td>
                </tr>
                <tr>
                  <td>Totale imponibile</td>
                  <td>€ {{(total + (total | percentage: 15)) | prettyNumber}}</td>
                </tr>
                <tr>
                  <td>Rivalsa parziale contributi previdenziali (4%)</td>
                  <td>€ {{((total + (total | percentage: 15)) | percentage: 4) | prettyNumber}}</td>
                </tr>
                <tr>
                  <td>Totale imponibile</td>
                  <td>€ {{(total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4)) | prettyNumber}}</td>
                </tr>
                <tr>
                  <td>Iva (22%)</td>
                  <td>€ {{((total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) | prettyNumber}}</td>
                </tr>
                <tr>
                  <th>&nbsp;</th>
                  <th>&nbsp;</th>
                </tr>
                <tr>
                  <th>
                    <span ng-if="matter.withholding_tax">Totale fattura</span>
                    <span ng-if="!matter.withholding_tax">Netto da Versare</span>
                  </th>
                  <th id="total">€ {{(total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) + (total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) | prettyNumber}}</th>
                </tr>

                <tr ng-if="matter.deposit > 0 && !matter.withholding_tax">
                  <th>Acconto</th>
                  <th id="total_acconto">€ {{((total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) + (total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) | percentage: matter.deposit) | prettyNumber}}</th>
                </tr>

                <tr ng-if="matter.deposit > 0 && !matter.withholding_tax">
                  <th>Saldo</th>
                  <th id="total_saldo">€ {{((total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) + (total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) | percentage: (100 - matter.deposit)) | prettyNumber}}</th>
                </tr>

                <tr ng-if="matter.withholding_tax">
                  <td>Ritenuta d'acconto (-20% Totale Imponibile)</td>
                  <td>€ {{((total + (total | percentage: 15)) | percentage: 20) | prettyNumber}}</td>
                </tr>

                <tr ng-if="matter.withholding_tax">
                  <th>Netto da versare</th>
                  <th id="total_withholding_tax">€ {{((total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) + (total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) - ((total + (total | percentage: 15)) | percentage: 20)) | prettyNumber}}</th>
                </tr>

                <tr ng-if="matter.deposit > 0 && matter.withholding_tax">
                  <th>Acconto</th>
                  <th id="total_withholding_tax_acconto">€ {{(((total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) + (total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) - ((total + (total | percentage: 15)) | percentage: 20)) | percentage: matter.deposit) | prettyNumber}}</th>
                </tr>

                <tr ng-if="matter.deposit > 0 && matter.withholding_tax">
                  <th>Saldo</th>
                  <th id="total_withholding_tax_saldo">€ {{(((total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) + (total + (total | percentage: 15) + ((total + (total | percentage: 15)) | percentage: 4) | percentage: 22)) - ((total + (total | percentage: 15)) | percentage: 20)) | percentage: (100 - matter.deposit)) | prettyNumber}}</th>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
