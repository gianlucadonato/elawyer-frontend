<div class="container matter matter-details">
  <div class="card m-t-25">
    <div class="card-header">
      <h2>Lettera di incarico</h2>
    </div>

    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Title</th>
              <th>Area</th>
              <th>Status</th>
              <th permission permission-only="['LAWYER', 'ADMIN']">Customer</th>
              <th permission permission-only="['CUSTOMER', 'ADMIN']">Lawyer</th>
              <th>Open Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{matter.title}}</td>
              <td>{{matter.area_of_interest}}</td>
              <td>
                <div class="flag flag-success" ng-if="matter.status == 'success'">Open</div>
                <div class="flag flag-pending" ng-if="matter.status == 'pending'">Pending</div>
                <div class="flag flag-closed" ng-if="matter.status == 'closed'">Closed</div>
              </td>
              <td permission permission-only="['LAWYER', 'ADMIN']">
                <a ui-sref="profile.details(matter.customer)">{{matter.customer.first_name}} {{matter.customer.last_name}}</a>
              </td>
              <td permission permission-only="['CUSTOMER', 'ADMIN']">
                <a ui-sref="profile.details(matter.customer)">{{matter.owner.first_name}} {{matter.owner.last_name}}</a>
              </td>
              <td>{{matter.created_at | amDateFormat: "DD MMMM YYYY" }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="row" ng-if="!showNext">
    <div class="col-sm-8">
      <div class="card m-t-25">
        <div class="card-header">
          <div ng-include="'views/partials/letterhead.html'"></div>
        </div>
        <div class="card-body card-padding">
          <h3>Lettera di incarico</h3>
          <hr/>
          <p>
            Il presente documento costituisce il preventivo e la lettera di incarico per l’attività di consulenza e assistenza legale richiesta (l’Incarico).<br/><br/>
            Le Condizioni Generali e l’Informativa in calce al presente documento costituiscono parte integrante e sostanziale dello stesso.
            <h4>Oggetto dell’Incarico</h4>
            L'incarico avrà per oggetto le seguenti attività:
          </p>

          <div ui-tree>
            <table ui-tree-nodes="" ng-model="matter.items" class="table table-bordered services">
              <thead>
                <tr>
                  <th></th>
                  <th>Services</th>
                  <th>Price</th>
                </tr>
              </thead>
              <tbody>
                <!-- SERVICES -->
                <tr ng-repeat="item in matter.items" ui-tree-node>
                  <td width="5%">
                    <div class="checkbox">
                      <label ng-if="!item.is_mandatory">
                        <input type="checkbox" ng-model="item.is_selected">
                        <i class="input-helper"></i>
                      </label>
                      <label ng-if="item.is_mandatory">
                        <input type="checkbox" checked disabled>
                        <i class="input-helper"></i>
                      </label>
                    </div>
                  </td>
                  <td width="80%">
                    <ul>
                      <li>
                        <h2 class="service-title">{{$index+1}}. {{item.title}}</h2>
                        <div>{{item.description}}</div>
                      </li>
                      <!-- SUB-SERVICES -->
                      <ol ui-tree-nodes="" ng-model="item.items" ng-if="item.items.length">
                        <li ng-repeat="subItem in item.items" ui-tree-node>
                          <h3 class="service-title">{{$parent.$parent.$index+1}}.{{$index+1}}. {{item.title}}</h3>
                          <div>{{item.description}}</div>
                        </li>
                      </ol>
                    </ul>
                  </td>
                  <td width="15%">
                    <span>€ {{item.price}}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card-footer card-padding card-actions">
          <button class="btn btn-orange btn-icon-text waves-effect" ng-click="next()">
            <span>Continue </span><i class="zmdi zmdi-arrow-forward"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="col-sm-4">
      <div id="summary-box" class="card m-t-25">
        <div class="card-header ch-alt">
          <h2>Sommario <small>Seleziona solo i servizi desiderati</small></h2>
        </div>
        <div class="card-body card-padding">
          <table width="100%">
            <tbody>
              <tr ng-repeat="srv in matter.items">
                <td width="85%">
                  <div class="checkbox">
                    <label ng-if="!srv.is_mandatory">
                      <input type="checkbox" ng-model="srv.is_selected">
                      <i class="input-helper"></i>
                      {{srv.title}}
                    </label>
                    <label ng-if="srv.is_mandatory">
                      <input type="checkbox" checked disabled>
                      <i class="input-helper"></i>
                      {{srv.title}}
                    </label>
                  </div>
                </td>
                <td>
                  € {{srv.price | prettyNumber}}
                </td>
              </tr>
              <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
              </tr>
              <tr>
                <th width="85%">Netto da Versare:</th>
                <th>€ {{total | prettyNumber}}</th>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="container">
  <section ng-include="'views/partials/summary-table.html'" ng-hide="!showNext"></section>
</div>


<div class="container" ng-hide="!showNext">
  <div style="display:inline-block; float:right">
    <button class="btn waves-effect" ng-click="showNext = false" style=""><i class="zmdi zmdi-arrow-back"></i><span> Indietro</span></button>
    <span ng-if="current_user.id == matter.customer.id">
    <button class="btn btn-info waves-effect" ng-click="pay(false)" ng-if="matter.deposit>0" style="">Paga acconto</button>
    <button class="btn btn-info waves-effect" ng-click="pay(true)" style="">Paga Fattura
      <span ng-if="matter.deposit>0"> complessiva</span>
    </button>
    </span>
  </div>
  <br/><br/><br/><br/>
</div>
